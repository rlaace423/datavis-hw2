<!doctype html>
<html lang="ko">
<head>
  <title>Line Chart</title>
  <meta charset="utf-8"/>
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>

  <style>
      /* ì»¨íŠ¸ë¡¤ ì˜ì—­: ê°€ë¡œë¡œ ë°°ì¹˜ + ì¤„ë°”ê¿ˆ */
      #controls {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin-bottom: 12px;
      }

      /* í´ëŸ½ ë²„íŠ¼(íƒ€ì¼) ê³µí†µ ìŠ¤íƒ€ì¼ */
      .club-tile {
          display: flex;
          align-items: center; /* ë¡œê³  + í…ìŠ¤íŠ¸ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
          justify-content: flex-start;
          padding: 4px 8px;
          min-width: 140px; /* â€œì¼ë°˜ì ì¸ ë²„íŠ¼ ì‚¬ì´ì¦ˆâ€ ì •ë„ */
          height: 40px; /* ë²„íŠ¼ ë†’ì´ í†µì¼ */
          box-sizing: border-box;
          border-radius: 6px;
          border: 1px solid #ddd;
          cursor: pointer;
          background: #f9f9f9;
          font-size: 12px;
          line-height: 1.2;
          transition: background 0.15s, box-shadow 0.15s, transform 0.1s, opacity 0.15s;
      }

      .club-tile:hover {
          background: #ffffff;
          box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);
          transform: translateY(-1px);
      }

      /* ë¹„í™œì„±í™”ëœ ìƒíƒœ(ì§€ê¸ˆ opacityë¡œ êµ¬ë¶„í•˜ëŠ” ë¶€ë¶„) */
      .club-tile.inactive {
          opacity: 0.35;
      }

      /* ë¡œê³  í¬ê¸° í†µì¼ */
      .club-logo {
          width: 24px;
          height: 24px;
          object-fit: contain; /* svg, png ì„ì—¬ë„ ê¹”ë”í•˜ê²Œ */
          margin-right: 6px;
          flex-shrink: 0;
      }

      /* í…ìŠ¤íŠ¸ëŠ” í•œ ì¤„, ë„ˆë¬´ ê¸¸ë©´ â€¦ ì²˜ë¦¬ ì˜µì…˜ë„ ê°€ëŠ¥ */
      .club-name {
          font-size: 12px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }
  </style>
</head>
<body>
<h1>EPL Club Value over Time</h1>
<div id="controls" style="width: 900px"></div>
<div id="vis"></div>

<script type="module">
  import {
    loadClubValueData,
    buildClubValueLineSpec,
  } from './index.js';

  const fullData = await loadClubValueData();

  // ë“±ì¥í•˜ëŠ” í´ëŸ½ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
  // const clubs = [...new Set(fullData.map(d => d.club_name))].sort();
  // ê³ ì • í´ëŸ½ ë¦¬ìŠ¤íŠ¸ (ìƒ‰ìƒ ê³ ì •ì„ ìœ„í•´)
  const CLUB_META = {
    'AFC Bournemouth': { color: '#DA020E', logo: 'images/club_logos/AFC_Bournemouth_logo_(introduced_2013).svg' },
    'Arsenal FC': { color: '#EF0107', logo: 'images/club_logos/Arsenal_FC_logo.svg' },
    'Aston Villa': { color: '#95BFE5', logo: 'images/club_logos/Aston_Villa_FC_2015.webp' },
    'Brentford FC': { color: '#D20000', logo: 'images/club_logos/Brentford_FC_2017.webp' },
    'Brighton & Hove Albion': { color: '#0057B8', logo: 'images/club_logos/Brighton_&_Hove_Albion_FC_logo.svg' },
    'Burnley FC': { color: '#7A003C', logo: 'images/club_logos/burnley.svg' },
    'Chelsea FC': { color: '#034694', logo: 'images/club_logos/Chelsea_FC_logo.svg' },
    'Crystal Palace': { color: '#C4122E', logo: 'images/club_logos/Crystal_Palace_FC_logo_(introduced_2013).svg' },
    'Everton FC': { color: '#003399', logo: 'images/club_logos/Everton_FC_logo_(introduced_2014).svg' },
    'Fulham FC': { color: '#CC0000', logo: 'images/club_logos/Fulham_FC_logo.svg' },
    'Leeds United': { color: '#FFCD00', logo: 'images/club_logos/Leeds_United_AFC_logo.svg' },
    'Liverpool FC': { color: '#C8102E', logo: 'images/club_logos/Liverpool_FC_logo.svg' },
    'Manchester City': { color: '#6CABDD', logo: 'images/club_logos/Manchester_City_2016.svg' },
    'Manchester United': { color: '#DA020E', logo: 'images/club_logos/Manchester_United_FC_logo.svg' },
    'Newcastle United': { color: '#241F20', logo: 'images/club_logos/Newcastle_United_FC_logo.svg' },
    'Nottingham Forest': {
      color: '#DD0000',
      logo: 'images/club_logos/Nottingham_Forest_FC_logo_(red,_two_stars_below).webp'
    },
    'Sunderland AFC': { color: '#FD1220', logo: 'images/club_logos/sunderland.svg' },
    'Tottenham Hotspur': { color: '#132257', logo: 'images/club_logos/Tottenham_Hotspur_FC_logo.svg' },
    'West Ham United': { color: '#7C2C3B', logo: 'images/club_logos/West_Ham_United_FC_logo_(2016).svg' },
    'Wolverhampton Wanderers': { color: '#FDB462', logo: 'images/club_logos/Wolverhampton_Wanderers_FC_logo.svg' },
  }
  const clubs = Object.keys(CLUB_META);
  const colorRange = clubs.map(club => CLUB_META[club].color);

  // í˜„ì¬ í‘œì‹œí•  í´ëŸ½ë“¤ (ì²˜ìŒì—” ì „ì²´ í‘œì‹œ)
  const selectedClubs = new Set(clubs);

  const controls = document.getElementById('controls');

  // ë²„íŠ¼ ë Œë”ë§
  clubs.forEach(club => {
    const meta = CLUB_META[club] || {};
    const tile = document.createElement('div');
    tile.className = 'club-tile';
    tile.setAttribute('role', 'button');
    tile.setAttribute('tabindex', '0');

    const img = document.createElement('img');
    img.className = 'club-logo';

    if (meta.logo) {
      img.src = meta.logo;  // PNGë“  SVGë“  ìƒê´€ ì—†ìŒ
      img.alt = club;
    } else {
      img.style.visibility = 'hidden';
    }

    const span = document.createElement('span');
    span.className = 'club-name';
    span.textContent = club;

    tile.appendChild(img);
    tile.appendChild(span);

    // í•„ìš”í•˜ë©´ íƒ€ì¼ ë°°ê²½ì— íŒ€ ì»¬ëŸ¬ë¥¼ ì‚´ì§ ì‚¬ìš©í•´ë„ ë¨
    if (meta.color) {
      tile.style.borderColor = meta.color;
      tile.style.background = meta.color + '11'; // ì‚´ì§ë§Œ ìƒ‰ ì…íˆê³  ì‹¶ì„ ë•Œ
    }

    // í† ê¸€ ìƒíƒœ í‘œì‹œìš©
    tile.dataset.active = 'true';

    tile.onclick = () => {
      if (selectedClubs.has(club)) {
        selectedClubs.delete(club);
        tile.dataset.active = 'false';
        tile.classList.add('inactive');   // ğŸ‘ˆ í´ë˜ìŠ¤ ì¶”ê°€
      } else {
        selectedClubs.add(club);
        tile.dataset.active = 'true';
        tile.classList.remove('inactive'); // ğŸ‘ˆ í´ë˜ìŠ¤ ì œê±°
      }
      render();
    };

    controls.appendChild(tile);
  });

  async function render() {
    const filtered = fullData.filter(d => selectedClubs.has(d.club_name));
    const spec = buildClubValueLineSpec(filtered, clubs, colorRange);
    await vegaEmbed('#vis', spec, { actions: false });
  }

  render();
</script>
</body>
</html>
